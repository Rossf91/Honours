<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>EIA-Interface: API Documentation</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul class="tablist">
      <li class="current"><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<h1>API Documentation </h1>  </div>
</div>
<div class="contents">
<p>The ARCompact ISA is designed to be extendable according to the requirements of the system in which it is used. These extensions may include more core and auxiliary registers, new instructions, and additional condition code tests.</p>
<p>The following API defines how to implement such extensions in software to enable simulation and testing of such extensions.</p>
<h2><a class="anchor" id="example_eia_extension"></a>
Example EIA Extension</h2>
<p>The following code demonstrates how to define a sample EIA Extension called with an extension condition code, extension instruction, extension core register, and an extension auxiliary register.</p>
<div class="fragment"><pre class="fragment"><span class="preprocessor"> #include &quot;api/api_funs.h&quot;</span>
<span class="preprocessor"> #include &quot;ise/eia/EiaExtension.h&quot;</span>
<span class="preprocessor"> #include &quot;ise/eia/EiaAuxRegister.h&quot;</span>
<span class="preprocessor"> #include &quot;ise/eia/EiaCoreRegister.h&quot;</span>
<span class="preprocessor"> #include &quot;ise/eia/EiaConditionCode.h&quot;</span>
<span class="preprocessor"> #include &quot;ise/eia/EiaInstruction.h&quot;</span>
 
 <span class="comment">// -----------------------------------------------------------------------------</span>
 <span class="comment">// Extension condition code</span>
 <span class="keyword">class </span>MyConditionCode: <span class="keyword">public</span> arcsim::ise::eia::EiaConditionCode
 {
 <span class="keyword">private</span>:
   uint32&amp;  auxr;
   uint32&amp;  r55;
 <span class="keyword">public</span>:
 <span class="keyword">explicit</span> MyConditionCode(<a class="code" href="classarcsim_1_1ise_1_1eia_1_1_eia_extension.html" title="EiaExtension base class.">arcsim::ise::eia::EiaExtension</a>* ext)
  : EiaConditionCode(ext,       <span class="comment">// EIA extension</span>
                    <span class="stringliteral">&quot;mycc&quot;</span>,    <span class="comment">// name  </span>
                    42),       <span class="comment">// number </span>
    auxr (*ext-&gt;get_aux_register (<span class="stringliteral">&quot;auxr&quot;</span>)-&gt;get_value_ptr()),
    r55  (*ext-&gt;get_core_register(<span class="stringliteral">&quot;r55&quot;</span> )-&gt;get_value_ptr())
    { }

  <span class="keywordtype">bool</span> eval_condition_code (uint8 cc)
  {
    <span class="keywordflow">return</span> (cc | auxr | r55);
  }
};

<span class="comment">// -----------------------------------------------------------------------------</span>
<span class="comment">// Extension instruction</span>
<span class="keyword">class </span>MyInstruction: <span class="keyword">public</span> arcsim::ise::eia::EiaInstruction
{
<span class="keyword">private</span>:
  uint32&amp;  auxr;
  uint32&amp;  r55;
<span class="keyword">public</span>:
  <span class="keyword">explicit</span> MyInstruction(<a class="code" href="classarcsim_1_1ise_1_1eia_1_1_eia_extension.html" title="EiaExtension base class.">arcsim::ise::eia::EiaExtension</a>* ext)
  : EiaInstruction(ext,                                   <span class="comment">// EIA extension</span>
                   <span class="stringliteral">&quot;myadd&quot;</span>,                               <span class="comment">// name</span>
                   arcsim::ise::eia::EiaInstructionInterface::DUAL_OPD, <span class="comment">// kind </span>
                   0xFF,                                  <span class="comment">// major opcode </span>
                   0xFFFF,                                <span class="comment">// opcode</span>
                   3,                                     <span class="comment">// cycles</span>
                   true,                                  <span class="comment">// has_dst</span>
                   false,                                 <span class="comment">// is_blocking</span>
                   true),                                 <span class="comment">// is_flag_setting</span>
  auxr (*ext-&gt;get_aux_register (<span class="stringliteral">&quot;auxr&quot;</span>)-&gt;get_value_ptr()),
  r55  (*ext-&gt;get_core_register(<span class="stringliteral">&quot;r55&quot;</span> )-&gt;get_value_ptr())
  { }
  
  uint32 eval_dual_opd (uint32     src1,
                        uint32     src2,
                        <a class="code" href="structarcsim_1_1ise_1_1eia_1_1_eia_bflags.html" title="EiaBflags structure.">arcsim::ise::eia::EiaBflags</a>  bflags_in,
                        <a class="code" href="structarcsim_1_1ise_1_1eia_1_1_eia_xflags.html" title="EiaXflags structure.">arcsim::ise::eia::EiaXflags</a>  xflags_in,
                        <a class="code" href="structarcsim_1_1ise_1_1eia_1_1_eia_bflags.html" title="EiaBflags structure.">arcsim::ise::eia::EiaBflags</a>* bflags_out,
                        <a class="code" href="structarcsim_1_1ise_1_1eia_1_1_eia_xflags.html" title="EiaXflags structure.">arcsim::ise::eia::EiaXflags</a>* xflags_out)
  {
    uint32 dst = (src1 + src2) * r55 + 0x10;
    <span class="keywordflow">if</span> (bflags_in.<a class="code" href="structarcsim_1_1ise_1_1eia_1_1_eia_bflags.html#a19c2c9d3e8c4b0cf11fce3322a92842f" title="struct field V.">V</a>)
    {
      <span class="keywordflow">if</span> (dst == 0)
        xflags_out-&gt;flag_1 = 1;
      <span class="keywordflow">else</span>
        xflags_out-&gt;flag_2 = 1;
    }
    auxr = dst;
    <span class="keywordflow">return</span> dst;
  }
};

<span class="comment">// -----------------------------------------------------------------------------</span>
<span class="comment">// EIA extension</span>
<span class="keyword">class </span>MyExtension : <span class="keyword">public</span> arcsim::ise::eia::EiaExtension,
<span class="keyword">public</span> arcsim::ise::eia::EiaExtensionFactory&lt;MyExtension&gt; {
<span class="keyword">public</span>:
  <span class="keyword">explicit</span> MyExtension(std::string name, std::string comment)
  : arcsim::ise::eia::EiaExtension(name, comment)
  { }
  
  <span class="keyword">static</span>  <a class="code" href="classarcsim_1_1ise_1_1eia_1_1_eia_extension_interface.html" title="EiaExtensionInterface.">arcsim::ise::eia::EiaExtensionInterface</a>* create_internal(<span class="keywordtype">void</span>)
  { <span class="comment">// 1. Create MyExtension</span>
    MyExtension* eia = <span class="keyword">new</span> MyExtension(<span class="stringliteral">&quot;myext&quot;</span>,           <span class="comment">// name</span>
                                       <span class="stringliteral">&quot;myext comment&quot;</span>);  <span class="comment">// comment</span>
    <span class="comment">// 2. Add EiaCoreRegister to MyExtension</span>
    eia-&gt;add_core_register(<span class="keyword">new</span> <a class="code" href="classarcsim_1_1ise_1_1eia_1_1_eia_core_register.html" title="EiaCoreRegister class.">arcsim::ise::eia::EiaCoreRegister</a>(<span class="stringliteral">&quot;r55&quot;</span>,  <span class="comment">// name</span>
                                                                 32,     <span class="comment">// number</span>
                                                                 0,      <span class="comment">// initial value</span>
                                                                 <span class="keyword">true</span>,   <span class="comment">// w_direct</span>
                                                                 <span class="keyword">false</span>,  <span class="comment">// w_prot</span>
                                                                 <span class="keyword">false</span>,  <span class="comment">// w_only</span>
                                                                 <span class="keyword">false</span>));<span class="comment">// r_only</span>
    <span class="comment">// 3. Add EiaAuxRegister to MyExtension</span>
    eia-&gt;add_aux_register(<span class="keyword">new</span> <a class="code" href="classarcsim_1_1ise_1_1eia_1_1_eia_aux_register.html" title="EiaAuxRegister class.">arcsim::ise::eia::EiaAuxRegister</a>(<span class="stringliteral">&quot;auxr&quot;</span>,   <span class="comment">// name</span>
                                                               0x4242,   <span class="comment">// number</span>
                                                               0,        <span class="comment">// initial value</span>
                                                               <span class="keyword">true</span>,     <span class="comment">// w_direct</span>
                                                               <span class="keyword">false</span>,    <span class="comment">// w_prot</span>
                                                               <span class="keyword">false</span>,    <span class="comment">// w_only</span>
                                                               <span class="keyword">false</span>));  <span class="comment">// r_only</span>
    <span class="comment">// 4. Add MyConditionCode to MyExtension</span>
    eia-&gt;add_cond_code(<span class="keyword">new</span> MyConditionCode(eia));
    <span class="comment">// 5. Add MyInstruction to MyExtension</span>
    eia-&gt;add_eia_instruction(<span class="keyword">new</span> MyInstruction(eia));
    <span class="keywordflow">return</span> eia;
  }
};
<span class="comment">// -----------------------------------------------------------------------------</span>
<span class="comment">// Function called by simulator giving control to EIA extension library so</span>
<span class="comment">// that it can register as many EIA extensions as it desires.</span>
<span class="comment">//</span>
<span class="keywordtype">void</span> simLoadEiaExtension (simContext ctx)
{
  simRegisterEiaExtension(ctx, 0, MyExtension::create());
}
<span class="comment">// Function called by test harness</span>
<span class="comment">//</span>
EiaExtensionInterfacePtr simCreateEiaExtension(uint32 eia_id)
{
  <span class="keywordflow">if</span> (eia_id == 0) { <span class="keywordflow">return</span> MyExtension::create(); }
  <span class="keywordflow">else</span>             { <span class="keywordflow">return</span> NULL;                  }
}
</pre></div> </div>
<hr class="footer"/><address class="footer"><small>Generated by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.1 </small></address>
</body>
</html>
